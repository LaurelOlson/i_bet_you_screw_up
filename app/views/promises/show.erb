<section class="article-body">
    
  <article class="container page-article">

    <header class="article-header">
      <%= erb :'partials/flash_message_success' %>
    </header>

    <div class="promise">
      <div class="promise-content">
        <div class="details">
          <p><%= @promise.content %></p>
        </div>
        <p class="promise-detail"><%= @promise.hours_until_expired %></p>
      </div>
      <div class="user-img">
        <img src="<%= @promise.user.gravatar %>">  
      </div>
    </div>

    <% if @current_user %> <!-- LOGGED IN -->

      <% if @promise.expired? || !@promise.validated.nil? %> <!-- PROMISE EXPIRED -->

        <% if @promise.validated %>
          <div class="promise-details">
            <h2>Promise Kept!</h2>
          </div>
        <% else %>
          <div class="promise-details">
            <h2><%= @promise.user.first_name %> screwed up.</h2>
          </div>
        <% end %>

      <% else %> <!-- PROMISE NOT EXPIRED -->

        <% if @current_user == @promise.user %> <!-- YOUR PROMISE -->

          <div class="form">
            <div class="promise-details">
              <form method="post" action="/promises/<%= @promise.id %>/validate">
                <h2>Did you keep your promise?</h2>
                <br>
                <input class="verify-promise" type="submit" name="yes" value="Promise Kept">
                <input class="verify-promise" type="submit" name="no" value="Promise Not Kept">
              </form>
              <br>
            </div>
          </div>

        <% else %> <!-- NOT YOUR PROMISE -->

          <%= erb :'partials/flash_message_error' %> <!-- successfully placed bet message -->

          <% if !@current_user_bet %> <!-- You haven't placed a bet yet -->

            <div class="form">
              <div class="promise-details">
                <form method="post" action="/promises/<%= @promise.id %>/new_bet">
                  <h2>Will <%= @promise.user.name %> keep their promise?</h2>
                  <br>
                  <input class="place_bet" type="text" name="bet_value" placeholder="Enter Bet Value" required autofocus>
                  <input class="place_bet" type="submit" name="in_favour" value="Yes (<%= @total_users_for_the_promise_to_be_kept %>)">
                  <input class="place_bet" type="submit" name="not_in_favour" value="No (<%= @total_users_against_the_promise_to_be_kept %>)">
                </form>
                <br>
              </div>
            </div>

          <% else %> <!-- You've already placed a bet -->

            <div class="promise-content">
              <h1>Your bet</h1>
              <h2>Value: <%= @current_user_bet.bet_value %></h2>
              <% if @current_user_bet.in_favour %>
                <p>You think <%= @promise.user.name %> will keep their promise!</p>
              <% else %>
                <p>You think <%= @promise.user.name %> will would screw-up!</p>
              <% end %>
            </div>

          <% end %>

        <% end %>

      <% end %>

    <% else %> <!-- NOT LOGGED IN -->

      <div class="form">
        <div class="promise-details">
          <form method="get" action="/login">
            <h2>Login to place a bet.</h2>
            <br>
            <input type="submit" name="yes" value="Login">
          </form>
          <br>
        </div>
      </div>

    <% end %>

    <header class="comments-header">
      <h1>Comments</h1>
    </header>
    <% if @current_user %>
    <div class="form-new-comment">
      <form method="post" action="/promises/<%= @promise.id %>/comment/new">
        <textarea id="comment-body" name="body" rows="2" placeholder="Add a comment.."></textarea>
        <input type="submit" value="Add Comment">
      </form>
    </div>
    <% else %>
      <p><a href="/login">Login</a> to post a comment</p>
    <% end %>

    <% @promise.ordered_comments.each do |comment| %>
      <div class="comment">
        <div class="comment-image">
          <img src="<%= comment.author.gravatar %>" alt="Logo image">
        </div>
        <div class="comment-content">
          <a href='/users/<%= comment.author.id %>'<h1><%= comment.author.name %></h1></a>
          <p><%= comment.body %></p>
          <p class="comment-detail">Posted on: <%= comment.created_at %></p>
        </div>
      </div>
    <% end %>

  </section>

    <!-- render pagination -->

  </article>

</section>